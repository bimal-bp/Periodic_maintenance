<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tipper Service Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .alert {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .alert-danger {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .notification-badge {
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 4px 4px 0 0;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: black;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #4CAF50;
            color: white;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }
        .visible {
            display: block;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tipper Service Tracker</h1>
        
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'dashboard')">Dashboard</button>
            <button class="tablinks" onclick="openTab(event, 'update')">Update Readings</button>
            <button class="tablinks" onclick="openTab(event, 'history')">Service History</button>
            <button class="tablinks" onclick="openTab(event, 'settings')">Settings</button>
        </div>
        
        <div id="dashboard" class="tabcontent visible">
            <h2>Service Alerts <span id="alert-count" class="notification-badge" style="display: none;">0</span></h2>
            <div id="alerts-container"></div>
            
            <h2>Current Status</h2>
            <table id="status-table">
                <thead>
                    <tr>
                        <th>Tipper No.</th>
                        <th>Current HMR</th>
                        <th>Current KMR</th>
                        <th>Last Service Date</th>
                        <th>Last Service HMR</th>
                        <th>Last Service KMR</th>
                        <th>Next Service Due</th>
                    </tr>
                </thead>
                <tbody id="status-body">
                    <!-- Filled by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="update" class="tabcontent">
            <h2>Update Tipper Readings</h2>
            <div class="form-group">
                <label for="tipper-select">Select Tipper:</label>
                <select id="tipper-select">
                    <option value="0926">0926</option>
                    <option value="0927">0927</option>
                    <option value="0928">0928</option>
                    <option value="4651">4651</option>
                    <option value="4652">4652</option>
                </select>
            </div>
            <div class="form-group">
                <label for="current-hmr">Current HMR:</label>
                <input type="number" id="current-hmr" placeholder="Enter current hour meter reading">
            </div>
            <div class="form-group">
                <label for="current-kmr">Current KMR:</label>
                <input type="number" id="current-kmr" placeholder="Enter current kilometer reading">
            </div>
            <div class="form-group">
                <label for="update-date">Date:</label>
                <input type="date" id="update-date" value="">
            </div>
            <button onclick="updateReadings()">Update Readings</button>
        </div>
        
        <div id="history" class="tabcontent">
            <h2>Service History</h2>
            <div class="form-group">
                <label for="history-tipper-select">Select Tipper:</label>
                <select id="history-tipper-select" onchange="loadServiceHistory()">
                    <option value="all">All Tippers</option>
                    <option value="0926">0926</option>
                    <option value="0927">0927</option>
                    <option value="0928">0928</option>
                    <option value="4651">4651</option>
                    <option value="4652">4652</option>
                </select>
            </div>
            <table id="history-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Tipper No.</th>
                        <th>Service Type</th>
                        <th>HMR</th>
                        <th>KMR</th>
                        <th>Parts Serviced</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    <!-- Filled by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div id="settings" class="tabcontent">
            <h2>Service Settings</h2>
            <div class="form-group">
                <label for="service-interval-hmr">Service Interval (HMR):</label>
                <input type="number" id="service-interval-hmr" value="1000">
            </div>
            <div class="form-group">
                <label for="service-interval-kmr">Service Interval (KMR):</label>
                <input type="number" id="service-interval-kmr" value="10000">
            </div>
            <div class="form-group">
                <label for="alert-threshold">Alert Threshold (% before due):</label>
                <input type="number" id="alert-threshold" value="10" min="1" max="100">
            </div>
            <div class="form-group">
                <label for="notification-frequency">Notification Frequency:</label>
                <select id="notification-frequency">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>
            <button onclick="saveSettings()">Save Settings</button>
        </div>
    </div>

    <script>
        // Initialize data
        let tippers = {
            "0926": { currentHmr: 873, currentKmr: 45637, lastServiceDate: "2025-06-17", lastServiceHmr: 873, lastServiceKmr: 45637 },
            "0927": { currentHmr: 1200, currentKmr: 55000, lastServiceDate: "2025-05-15", lastServiceHmr: 1000, lastServiceKmr: 50000 },
            "0928": { currentHmr: 950, currentKmr: 48000, lastServiceDate: "2025-06-10", lastServiceHmr: 800, lastServiceKmr: 40000 },
            "4651": { currentHmr: 1500, currentKmr: 70000, lastServiceDate: "2025-04-20", lastServiceHmr: 1000, lastServiceKmr: 60000 },
            "4652": { currentHmr: 500, currentKmr: 30000, lastServiceDate: "2025-06-05", lastServiceHmr: 0, lastServiceKmr: 25000 }
        };

        let serviceHistory = [
            { date: "2025-06-17", tipper: "0926", serviceType: "1000 Hrs", hmr: 873, kmr: 45637, parts: "All 1000hr parts" },
            { date: "2025-06-10", tipper: "0928", serviceType: "1000 Hrs", hmr: 800, kmr: 40000, parts: "All 1000hr parts" },
            { date: "2025-06-05", tipper: "4652", serviceType: "Initial", hmr: 0, kmr: 25000, parts: "All 1000hr parts" },
            { date: "2025-05-15", tipper: "0927", serviceType: "1000 Hrs", hmr: 1000, kmr: 50000, parts: "All 1000hr parts" },
            { date: "2025-04-20", tipper: "4651", serviceType: "1000 Hrs", hmr: 1000, kmr: 60000, parts: "All 1000hr parts" }
        ];

        let settings = {
            serviceIntervalHmr: 1000,
            serviceIntervalKmr: 10000,
            alertThreshold: 10,
            notificationFrequency: "daily"
        };

        // Parts that come under 1000 Hrs service
        const serviceParts = [
            "Engine Oil - Gulf",
            "Engine Oil Filter",
            "Fuel Filter",
            "By Pass Filter",
            "Racor (Fuel) Filter",
            "Primary & Secondary Air Filter",
            "Breather Element Filter",
            "Return Line Filter"
        ];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default in the update form
            document.getElementById('update-date').valueAsDate = new Date();
            
            // Load settings from localStorage if available
            loadSettings();
            
            // Initialize the dashboard
            updateDashboard();
            loadServiceHistory();
        });

        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("visible");
            }
            
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            document.getElementById(tabName).classList.add("visible");
            evt.currentTarget.className += " active";
        }

        function updateDashboard() {
            const statusBody = document.getElementById('status-body');
            statusBody.innerHTML = '';
            
            let alertCount = 0;
            const alertsContainer = document.getElementById('alerts-container');
            alertsContainer.innerHTML = '';
            
            for (const tipper in tippers) {
                const data = tippers[tipper];
                const nextServiceHmr = data.lastServiceHmr + settings.serviceIntervalHmr;
                const nextServiceKmr = data.lastServiceKmr + settings.serviceIntervalKmr;
                
                const hmrRemaining = nextServiceHmr - data.currentHmr;
                const kmrRemaining = nextServiceKmr - data.currentKmr;
                
                const hmrPercent = (data.currentHmr - data.lastServiceHmr) / settings.serviceIntervalHmr * 100;
                const kmrPercent = (data.currentKmr - data.lastServiceKmr) / settings.serviceIntervalKmr * 100;
                
                // Determine which service comes first (HMR or KMR)
                const nextServiceDue = Math.min(hmrRemaining, kmrRemaining);
                const nextServiceType = hmrRemaining < kmrRemaining ? "HMR" : "KMR";
                
                // Check if service is due or approaching
                const thresholdHmr = settings.serviceIntervalHmr * (settings.alertThreshold / 100);
                const thresholdKmr = settings.serviceIntervalKmr * (settings.alertThreshold / 100);
                
                if (data.currentHmr >= nextServiceHmr || data.currentKmr >= nextServiceKmr) {
                    // Service overdue
                    alertsContainer.innerHTML += `
                        <div class="alert alert-danger">
                            <strong>${tipper}:</strong> Service is overdue! ${nextServiceType} exceeded by 
                            ${Math.abs(nextServiceDue)} (HMR: ${data.currentHmr}/${nextServiceHmr}, KMR: ${data.currentKmr}/${nextServiceKmr})
                        </div>
                    `;
                    alertCount++;
                } else if ((hmrRemaining <= thresholdHmr) || (kmrRemaining <= thresholdKmr)) {
                    // Service approaching
                    alertsContainer.innerHTML += `
                        <div class="alert alert-warning">
                            <strong>${tipper}:</strong> Service due soon (${nextServiceType} in ${nextServiceDue}). 
                            HMR: ${Math.round(hmrPercent)}%, KMR: ${Math.round(kmrPercent)}%
                        </div>
                    `;
                    alertCount++;
                }
                
                // Add to status table
                statusBody.innerHTML += `
                    <tr>
                        <td>${tipper}</td>
                        <td>${data.currentHmr}</td>
                        <td>${data.currentKmr}</td>
                        <td>${formatDate(data.lastServiceDate)}</td>
                        <td>${data.lastServiceHmr}</td>
                        <td>${data.lastServiceKmr}</td>
                        <td>${nextServiceDue} (${nextServiceType})</td>
                    </tr>
                `;
            }
            
            // Update alert badge
            const alertBadge = document.getElementById('alert-count');
            if (alertCount > 0) {
                alertBadge.textContent = alertCount;
                alertBadge.style.display = 'inline';
            } else {
                alertBadge.style.display = 'none';
            }
        }

        function updateReadings() {
            const tipper = document.getElementById('tipper-select').value;
            const hmr = parseInt(document.getElementById('current-hmr').value);
            const kmr = parseInt(document.getElementById('current-kmr').value);
            const date = document.getElementById('update-date').value;
            
            if (isNaN(hmr) || isNaN(kmr)) {
                alert("Please enter valid HMR and KMR values");
                return;
            }
            
            // Update current readings
            tippers[tipper].currentHmr = hmr;
            tippers[tipper].currentKmr = kmr;
            
            // Check if this is a service update (if readings are reset or significantly lower)
            const lastHmr = tippers[tipper].lastServiceHmr;
            const lastKmr = tippers[tipper].lastServiceKmr;
            
            if (hmr < lastHmr || kmr < lastKmr) {
                // This is a service record
                tippers[tipper].lastServiceDate = date;
                tippers[tipper].lastServiceHmr = hmr;
                tippers[tipper].lastServiceKmr = kmr;
                
                // Add to service history
                serviceHistory.unshift({
                    date: date,
                    tipper: tipper,
                    serviceType: "1000 Hrs",
                    hmr: hmr,
                    kmr: kmr,
                    parts: serviceParts.join(", ")
                });
            }
            
            // Update the dashboard
            updateDashboard();
            loadServiceHistory();
            
            // Clear the form
            document.getElementById('current-hmr').value = '';
            document.getElementById('current-kmr').value = '';
            
            alert("Readings updated successfully!");
        }

        function loadServiceHistory() {
            const tipper = document.getElementById('history-tipper-select').value;
            const historyBody = document.getElementById('history-body');
            historyBody.innerHTML = '';
            
            let filteredHistory = serviceHistory;
            if (tipper !== 'all') {
                filteredHistory = serviceHistory.filter(record => record.tipper === tipper);
            }
            
            filteredHistory.forEach(record => {
                historyBody.innerHTML += `
                    <tr>
                        <td>${formatDate(record.date)}</td>
                        <td>${record.tipper}</td>
                        <td>${record.serviceType}</td>
                        <td>${record.hmr}</td>
                        <td>${record.kmr}</td>
                        <td>${record.parts}</td>
                    </tr>
                `;
            });
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('tipperServiceSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                
                document.getElementById('service-interval-hmr').value = settings.serviceIntervalHmr;
                document.getElementById('service-interval-kmr').value = settings.serviceIntervalKmr;
                document.getElementById('alert-threshold').value = settings.alertThreshold;
                document.getElementById('notification-frequency').value = settings.notificationFrequency;
            }
        }

        function saveSettings() {
            settings.serviceIntervalHmr = parseInt(document.getElementById('service-interval-hmr').value);
            settings.serviceIntervalKmr = parseInt(document.getElementById('service-interval-kmr').value);
            settings.alertThreshold = parseInt(document.getElementById('alert-threshold').value);
            settings.notificationFrequency = document.getElementById('notification-frequency').value;
            
            localStorage.setItem('tipperServiceSettings', JSON.stringify(settings));
            alert("Settings saved successfully!");
            
            // Update dashboard with new settings
            updateDashboard();
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Check for notifications periodically based on settings
        function checkNotifications() {
            // In a real app, this would check for notifications and show them
            console.log("Checking for notifications...");
            
            // For demo purposes, we'll just update the dashboard
            updateDashboard();
        }

        // Set up periodic notification checking based on settings
        setInterval(checkNotifications, getNotificationInterval());

        function getNotificationInterval() {
            switch(settings.notificationFrequency) {
                case 'weekly': return 7 * 24 * 60 * 60 * 1000; // 1 week
                case 'monthly': return 30 * 24 * 60 * 60 * 1000; // ~1 month
                default: return 24 * 60 * 60 * 1000; // Default daily
            }
        }
    </script>
</body>
</html>
