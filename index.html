<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGX Mineral Tipper Maintenance</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .tipper-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .tipper-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            position: relative;
        }
        
        .tipper-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .tipper-name {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }
        
        .status.green {
            background-color: var(--success);
        }
        
        .status.yellow {
            background-color: var(--warning);
        }
        
        .status.red {
            background-color: var(--secondary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .update-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .service-section {
            margin: 25px 0 15px;
        }
        
        .service-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            justify-content: space-between;
        }
        
        .countdown {
            font-size: 17px;
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .countdown.normal {
            background-color: #e8f5e9;
            color: var(--success);
            border-left: 5px solid var(--success);
        }
        
        .countdown.warning {
            background-color: #fff8e1;
            color: var(--warning);
            border-left: 5px solid var(--warning);
        }
        
        .countdown.danger {
            background-color: #ffebee;
            color: var(--secondary);
            border-left: 5px solid var(--secondary);
        }
        
        .service-items {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .service-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid var(--primary);
            font-size: 14px;
        }
        
        .alert-banner {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .alert-banner.warning {
            background-color: #fff3e0;
            color: var(--warning);
            border: 1px solid var(--warning);
        }
        
        .alert-banner.danger {
            background-color: #ffebee;
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }
        
        .alert-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .email-notification {
            background-color: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }
        
        @media (max-width: 768px) {
            .tipper-container {
                grid-template-columns: 1fr;
            }
            
            .stats-grid, .service-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>SGX Mineral Tipper Maintenance</h1>
    </header>
    
    <div class="container">
        <div class="tipper-container">
            <!-- Tipper AP39W027 -->
            <div class="tipper-card" id="tipper-AP39W027">
                <div class="tipper-header">
                    <div class="tipper-name">AP39W027</div>
                    <div class="status yellow" id="status-AP39W027">DUE SOON</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Last Updated HMR</div>
                        <div class="stat-value" id="hmr-AP39W027">3,950</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Updated KMR</div>
                        <div class="stat-value" id="kmr-AP39W027">23,456</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last 1000H Service</div>
                        <div class="stat-value" id="last-1000h-AP39W027">3,092</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last 2000H Service</div>
                        <div class="stat-value" id="last-2000h-AP39W027">2,069</div>
                    </div>
                </div>
                
                <div class="update-section">
                    <h3>Daily Update</h3>
                    <div class="form-group">
                        <label>Today's HMR</label>
                        <input type="number" id="today-hmr-AP39W027" placeholder="Enter current HMR">
                    </div>
                    <div class="form-group">
                        <label>Today's KMR</label>
                        <input type="number" id="today-kmr-AP39W027" placeholder="Enter current KMR">
                    </div>
                    <button class="btn btn-primary" onclick="updateTipper('AP39W027')">Update</button>
                </div>
                
                <!-- 1000H Service Section -->
                <div class="service-section">
                    <div class="service-header">
                        <span>1000H Service</span>
                        <span>Next Due: 4,092 HMR</span>
                    </div>
                    <div class="countdown normal" id="countdown-1000h-AP39W027">
                        Due in: 858 hours
                    </div>
                    <div class="service-items">
                        <div class="service-item">Engine Oil Change</div>
                        <div class="service-item">Oil Filter Replacement</div>
                        <div class="service-item">Fuel Filter Change</div>
                        <div class="service-item">Air Filter Cleaning</div>
                    </div>
                </div>
                
                <!-- 2000H Service Section -->
                <div class="service-section">
                    <div class="service-header">
                        <span>2000H Service</span>
                        <span>Next Due: 4,069 HMR</span>
                    </div>
                    <div class="countdown warning" id="countdown-2000h-AP39W027">
                        Due in: 119 hours
                    </div>
                    <div class="service-items">
                        <div class="service-item">Transmission Oil Change</div>
                        <div class="service-item">Differential Oil Change</div>
                        <div class="service-item">Brake System Inspection</div>
                        <div class="service-item">Coolant Replacement</div>
                    </div>
                </div>
            </div>
            
            <!-- Tipper AP39WO28 -->
            <div class="tipper-card" id="tipper-AP39WO28">
                <div class="tipper-header">
                    <div class="tipper-name">AP39WO28</div>
                    <div class="status red" id="status-AP39WO28">OVERDUE</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Last Updated HMR</div>
                        <div class="stat-value" id="hmr-AP39WO28">4806</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last Updated KMR</div>
                        <div class="stat-value" id="kmr-AP39WO28">30,789</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last 1000H Service</div>
                        <div class="stat-value" id="last-1000h-AP39WO28">3,853</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Last 2000H Service</div>
                        <div class="stat-value" id="last-2000h-AP39WO28">2,753</div>
                    </div>
                </div>
                
                <div class="alert-banner danger">
                    <span class="alert-icon">⚠️</span>
                    <span>URGENT: 1000H Service overdue by 47 hours! Mail has sent to Maintenance Team and management </span>
                </div>
                
                <div class="email-notification" id="email-notification-AP39WO28">
                    <strong>Email Sent:</strong> Maintenance team notified about overdue service
                </div>
                
                <div class="update-section">
                    <h3>Daily Update</h3>
                    <div class="form-group">
                        <label>Today's HMR</label>
                        <input type="number" id="today-hmr-AP39WO28" placeholder="Enter current HMR">
                    </div>
                    <div class="form-group">
                        <label>Today's KMR</label>
                        <input type="number" id="today-kmr-AP39WO28" placeholder="Enter current KMR">
                    </div>
                    <button class="btn btn-primary" onclick="updateTipper('AP39WO28')">Update</button>
                </div>
                
                <!-- 1000H Service Section -->
                <div class="service-section">
                    <div class="service-header">
                        <span>1000H Service</span>
                        <span>Next Due: 4,853 HMR</span>
                    </div>
                    <div class="countdown danger" id="countdown-1000h-AP39WO28">
                        OVERDUE by 47 hours
                    </div>
                    <div class="service-items">
                        <div class="service-item">Engine Oil Change</div>
                        <div class="service-item">Oil Filter Replacement</div>
                        <div class="service-item">Fuel Filter Change</div>
                        <div class="service-item">Air Filter Cleaning</div>
                    </div>
                </div>
                
                <!-- 2000H Service Section -->
                <div class="service-section">
                    <div class="service-header">
                        <span>2000H Service</span>
                        <span>Next Due: 4,753 HMR</span>
                    </div>
                    <div class="countdown normal" id="countdown-2000h-AP39WO28">
                        Due in: 500 hours
                    </div>
                    <div class="service-items">
                        <div class="service-item">Transmission Oil Change</div>
                        <div class="service-item">Differential Oil Change</div>
                        <div class="service-item">Brake System Inspection</div>
                        <div class="service-item">Coolant Replacement</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tipper data
        const tippers = {
            'AP39W027': {
                name: 'AP39W027',
                currentHmr: 3950,
                currentKmr: 23456,
                last1000hService: 3092,
                last2000hService: 2069,
                next1000hDue: 4092,  // 3092 + 1000
                next2000hDue: 4069,   // 2069 + 2000
                lastUpdateDate: '18/07/2023',
                emailSent: false
            },
            'AP39WO28': {
                name: 'AP39WO28',
                currentHmr: 4253,
                currentKmr: 30789,
                last1000hService: 3853,
                last2000hService: 2753,
                next1000hDue: 4853,  // 3853 + 1000
                next2000hDue: 4753,   // 2753 + 2000
                lastUpdateDate: '15/07/2023',
                emailSent: true
            }
        };
        
        // Update tipper data and display
        function updateTipper(id) {
            const todayHmr = parseInt(document.getElementById(`today-hmr-${id}`).value);
            const todayKmr = parseInt(document.getElementById(`today-kmr-${id}`).value);
            
            if (isNaN(todayHmr)) {
                alert('Please enter valid HMR reading');
                return;
            }
            
            // Update tipper data
            tippers[id].currentHmr = todayHmr;
            tippers[id].currentKmr = todayKmr || tippers[id].currentKmr;
            tippers[id].lastUpdateDate = new Date().toLocaleDateString('en-GB');
            
            // Update display
            updateDisplay(id);
            
            // Check for service due and send alerts
            checkServiceStatus(id);
            
            // Clear form
            document.getElementById(`today-hmr-${id}`).value = '';
            document.getElementById(`today-kmr-${id}`).value = '';
        }
        
        // Update the display for a tipper
        function updateDisplay(id) {
            const tipper = tippers[id];
            
            // Update basic stats
            document.getElementById(`hmr-${id}`).textContent = tipper.currentHmr.toLocaleString();
            document.getElementById(`kmr-${id}`).textContent = tipper.currentKmr.toLocaleString();
            document.getElementById(`last-1000h-${id}`).textContent = tipper.last1000hService.toLocaleString();
            document.getElementById(`last-2000h-${id}`).textContent = tipper.last2000hService.toLocaleString();
            
            // Calculate hours remaining/overdue for both services
            const hoursTo1000h = tipper.next1000hDue - tipper.currentHmr;
            const hoursTo2000h = tipper.next2000hDue - tipper.currentHmr;
            
            // Determine overall status
            let overallStatus = 'green';
            let alertMessage = '';
            let showAlert = false;
            
            // Update 1000H service display
            updateServiceDisplay(id, '1000h', hoursTo1000h, tipper.next1000hDue);
            
            // Update 2000H service display
            updateServiceDisplay(id, '2000h', hoursTo2000h, tipper.next2000hDue);
            
            // Set overall status based on most urgent service
            if (hoursTo1000h <= 0 || hoursTo2000h <= 0) {
                overallStatus = 'red';
                showAlert = true;
                const overdueService = hoursTo1000h <= 0 ? '1000H' : '2000H';
                const overdueHours = Math.abs(hoursTo1000h <= 0 ? hoursTo1000h : hoursTo2000h);
                alertMessage = `URGENT: ${overdueService} Service overdue by ${overdueHours} hours!`;
            } else if (hoursTo1000h <= 50 || hoursTo2000h <= 50) {
                overallStatus = 'red';
                showAlert = true;
                const dueService = hoursTo1000h <= 50 ? '1000H' : '2000H';
                alertMessage = `URGENT: ${dueService} Service due in ${hoursTo1000h <= 50 ? hoursTo1000h : hoursTo2000h} hours!`;
            } else if (hoursTo1000h <= 100 || hoursTo2000h <= 100) {
                overallStatus = 'yellow';
                showAlert = true;
                const dueService = hoursTo1000h <= 100 ? '1000H' : '2000H';
                alertMessage = `WARNING: ${dueService} Service due in ${hoursTo1000h <= 100 ? hoursTo1000h : hoursTo2000h} hours`;
            }
            
            // Update status badge
            const statusElement = document.getElementById(`status-${id}`);
            statusElement.className = `status ${overallStatus}`;
            
            if (overallStatus === 'green') {
                statusElement.textContent = 'ON TRACK';
                document.querySelector(`#tipper-${id} .alert-banner`).style.display = 'none';
            } else if (overallStatus === 'yellow') {
                statusElement.textContent = 'DUE SOON';
                document.querySelector(`#tipper-${id} .alert-banner`).style.display = 'flex';
                document.querySelector(`#tipper-${id} .alert-banner`).className = 'alert-banner warning';
                document.querySelector(`#tipper-${id} .alert-banner span:last-child`).textContent = alertMessage;
            } else {
                statusElement.textContent = 'OVERDUE';
                document.querySelector(`#tipper-${id} .alert-banner`).style.display = 'flex';
                document.querySelector(`#tipper-${id} .alert-banner`).className = 'alert-banner danger';
                document.querySelector(`#tipper-${id} .alert-banner span:last-child`).textContent = alertMessage;
            }
            
            // Show email notification if sent
            if (tipper.emailSent) {
                document.getElementById(`email-notification-${id}`).style.display = 'block';
            } else {
                document.getElementById(`email-notification-${id}`).style.display = 'none';
            }
        }
        
        // Update service display
        function updateServiceDisplay(id, serviceType, hoursRemaining, nextDueAt) {
            const countdownElement = document.getElementById(`countdown-${serviceType}-${id}`);
            const serviceHeaderElement = document.querySelector(`#tipper-${id} .service-section:nth-of-type(${serviceType === '1000h' ? 1 : 2}) .service-header span:last-child`);
            
            // Update next due in header
            serviceHeaderElement.textContent = `Next Due: ${nextDueAt.toLocaleString()} HMR`;
            
            if (hoursRemaining <= 0) {
                // Overdue
                const overdueHours = Math.abs(hoursRemaining);
                countdownElement.textContent = `OVERDUE by ${overdueHours} hours`;
                countdownElement.className = 'countdown danger';
            } else if (hoursRemaining <= 50) {
                // Due immediately (0-50 hours)
                countdownElement.textContent = `Due in ${hoursRemaining} hours`;
                countdownElement.className = 'countdown danger';
            } else if (hoursRemaining <= 100) {
                // Warning (50-100 hours)
                countdownElement.textContent = `Due in ${hoursRemaining} hours`;
                countdownElement.className = 'countdown warning';
            } else {
                // Normal (>100 hours)
                countdownElement.textContent = `Due in ${hoursRemaining} hours`;
                countdownElement.className = 'countdown normal';
            }
        }
        
        // Check service status and send alerts
        function checkServiceStatus(id) {
            const tipper = tippers[id];
            const hoursTo1000h = tipper.next1000hDue - tipper.currentHmr;
            const hoursTo2000h = tipper.next2000hDue - tipper.currentHmr;
            
            // Check if we need to send email alerts
            if ((hoursTo1000h <= 0 || hoursTo2000h <= 0 || 
                hoursTo1000h <= 100 || hoursTo2000h <= 100) && !tipper.emailSent) {
                sendEmailAlert(id, hoursTo1000h, hoursTo2000h);
                tipper.emailSent = true;
                document.getElementById(`email-notification-${id}`).style.display = 'block';
            }
        }
        
        // Send email alert
        function sendEmailAlert(id, hoursTo1000h, hoursTo2000h) {
            const tipper = tippers[id];
            let subject = '';
            let message = '';
            
            if (hoursTo1000h <= 0 || hoursTo2000h <= 0) {
                // Overdue alert
                const overdueService = hoursTo1000h <= 0 ? '1000H' : '2000H';
                const overdueHours = Math.abs(hoursTo1000h <= 0 ? hoursTo1000h : hoursTo2000h);
                subject = `URGENT: ${tipper.name} ${overdueService} Service OVERDUE`;
                message = `Vehicle ${tipper.name} is overdue for ${overdueService} service by ${overdueHours} hours.\n\n` +
                          `Current HMR: ${tipper.currentHmr}\n` +
                          `${overdueService} Service was due at: ${hoursTo1000h <= 0 ? tipper.next1000hDue : tipper.next2000hDue} HMR\n\n` +
                          `Please service immediately to avoid equipment damage.`;
            } else if (hoursTo1000h <= 50 || hoursTo2000h <= 50) {
                // Due immediately alert
                const dueService = hoursTo1000h <= 50 ? '1000H' : '2000H';
                const dueHours = hoursTo1000h <= 50 ? hoursTo1000h : hoursTo2000h;
                subject = `URGENT: ${tipper.name} ${dueService} Service Due Soon`;
                message = `Vehicle ${tipper.name} needs ${dueService} service in ${dueHours} hours.\n\n` +
                          `Current HMR: ${tipper.currentHmr}\n` +
                          `${dueService} Service due at: ${hoursTo1000h <= 50 ? tipper.next1000hDue : tipper.next2000hDue} HMR\n\n` +
                          `Please schedule this service immediately.`;
            } else if (hoursTo1000h <= 100 || hoursTo2000h <= 100) {
                // Warning alert
                const dueService = hoursTo1000h <= 100 ? '1000H' : '2000H';
                const dueHours = hoursTo1000h <= 100 ? hoursTo1000h : hoursTo2000h;
                subject = `WARNING: ${tipper.name} ${dueService} Service Approaching`;
                message = `Vehicle ${tipper.name} will need ${dueService} service in ${dueHours} hours.\n\n` +
                          `Current HMR: ${tipper.currentHmr}\n` +
                          `${dueService} Service due at: ${hoursTo1000h <= 100 ? tipper.next1000hDue : tipper.next2000hDue} HMR\n\n` +
                          `Please plan for this upcoming service.`;
            }
            
            console.log(`Email Alert for ${tipper.name}:`);
            console.log(`To: maintenance@sgxmineral.com, fleetmanager@sgxmineral.com`);
            console.log(`Subject: ${subject}`);
            console.log(`Message: ${message}`);
        }
        
        // Initialize display
        window.onload = function() {
            updateDisplay('AP39W027');
            updateDisplay('AP39WO28');
        };
    </script>
</body>
</html>
